<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Connecting Intercity Rail with Inner-city Transit</title>
    <link rel="shortcut icon" href="favicon.ico?" type="image/x-icon">
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src="https://unpkg.com/scrollama"></script>
    <link href='styles.css' rel='stylesheet'/>

</head>
<body>

<img src="./images/Amtrak.jpeg" style="max-width: 100%">

<div id="img-header">
    <h1>Connecting Intercity Rail with Inner-city Transit</h1>

    <em>
        <p>
            By Xiomar Banks
        </p>

        <p style="font-size: 0.8em;">
        </p>
    </em>
        <p>
            Currently, the situation is that people who want to travel have to buy multiple tickets for each mode of transportation. This causes a lot of stress, time, and money for many people. Customers who want to travel between cities, and around a city, must go through hurdles to acquire tickets at each mode of transportation. This is especially going to be a problem when the World Cup comes to the United States in 2026. Now foreign travelers, domestic travelers, and sports enthusiasts, will have to spend extra time trying to understand America's complex transportation systems.
        </p>
</div>

<div id="text-container">

    <!-- (there is an out-of-focus photo 
that could work for the title) TK TITLE -->

<!-- Intro -->

    <p>
        Since the World Cup will be hosted by the United States in 2026, people will need an easier and convenient way to transfer between Amtrak and urban transit operators to get to the stadiums the World Cup will be played. Customers will have to learn about each city's urban transit policies and fares when getting off Amtrak and transferring to a city's commuter, like SEPTA in Philadelphia, or the MTA in New York City. 
    </p>
    <p>
         In Philadelphia, for example, if a customer is coming from the Acela, Amtrak, and want to get to the World Cup stadium, they will have to transfer from Amtrak to either the trolley, or MFL, to the BSL, which requires different tickets for each mode. But under a through-ticketing program, this all could be made simpler.
    </p>
</b>

<!-- the route -->
    <h2>What is Through-Ticketing?</h2>

    <p>
        Through-ticketing is the process of having one ticket for multiple modes of transportation. This is not a new concept, in fact, Germany already have a through-ticketing program with planes and trains called "AIRail". This program is limited to what airports and train terminals can be used, but is substantive enough to be a major transporting partner of Germany. Also, America host a multi-journey site that helps organize different flights from different airlines called "Google Flights". Though that is not through-ticketing, it is some source of ingenuity that offers a cohesive journey organizer.
    </p>

    <!-- <img id="chart" src="charts/images/order-wait.png"> -->

    <p>
        Currently, Amtrak has existing through-ticketing and cross-honoring arrangements in place with NJT and SEPTA. With NJT, Amtrak supports travel to Atlantic City by allowing passengers to use their Amtrak ticket to Philadelphia to board an NJT train onward to Atlantic City (NECC, 2018). This is a specific destination that Amtrak allows through-ticketing to; Atlantic City is the only endpoint and route supported in this approach. This is one of the challenges that need to be addressed: last mile traveled. However, some of these through-ticketing options do not include all transit stops making it difficult for riders to even get to their last mile destinations. Though these examples are current through-ticketing options, they have problems that need to be addressed. For example, showing tickets to the conductor may suffice for Amtrak, however, at each NJT turnstile, there has to be a barcode reader installed. 
    </p>

    <p>
        Amtrak also has arrangements with United Airlines as a codesharing agreement. Codesharing is when two or more transportation providers public and market the same service under their own brand and timetable. While tickets can be purchased through either operator, the service is operated by one company (NECC, 2018).  This codesharing agreement is only for commuters traveling to the Newark Liberty International and at select NEC stations such as Philadelphiaâ€™s 30th Street.
    </p>

    <p>
        The average person spends too much time between transferring between Amtrak and public transit. On average, the average person spends an extra 10 minutes searching for the appropriate ticket for their journey. This process could be made easier if the ticketing process was a through-ticketing solution. But since that is not the current situation, we can assume the map below is about the current time it takes for a customer to get from Penn Station, in New York to the Lincoln Financial Field in Philadelphia (where the World Cup will be played). 
    </p>
    <p>
        Lets follow the time it takes a typical customer who just wanted to watch the World Cup matches in person.
    </p>

</div>

<!-- MAP HERE -->
<div id="map"></div>

<!-- this is where elements are appended. DON'T DELETE -->
<div id="story">
</div>

<!-- text CONTINUED -->
<div id="text-container">

    <p>As you can see, it takes much time to not use a through-ticketing solution for travel. The current ticketing method in place does not allow for ease of travel. 
    </p>

    <h2>Methodology</h2>

    <p>The way this through-ticketing program would work would require a lot of government intervention. But I am not going to get into all the technical policies that are required to achieve such program. I will, however, mention how I got here with my map and data points. First, I created a geojson file with QGIS of all the required lines and tracks of each mode of transportation (from NYC to Philly). Then, I manipulated code data to create this website that shows the maps and follow points of the travelers mobility. Last, I tested my data, and made plenty of iterations controlling for results that you can see here. </p>

    <img id="photo" src="./images/13xp-amtrak-albany-articleLarge.png">

<!-- the road map -->
    <h2>Challenges</h2>

    <p>I have encountered some challenges along the way. Mainly, challenges with the data, with QGIS outputs, and with the code itself. My biggest challenge was converting a MultiLineString to a LineString from QGIS so the javascript code can read the coordinates properly. Even after completing this code, I ran into issues of the code not reading all of the coordinates given. I tried manipulating the geojson file, downloading new geojson files, and even searching online for answers to my questions. Nothing seemed to work. But after all that, i figured out what went wrong and got my website to write the map as shown.
    </p>

<!-- section 3 -->
    <h2>Conclusion</h2>

    <p>In conclusion, traveling from city to city to watch the World Cup can be made easier with the help of through-ticketing. If the method had to be chosen, I believe more people would choose through-ticketing than the current method of travel. Purchasing multiple tickets at each new transit mode can be tiresome and daunting. But with though-ticketing, there would be less time spent trying to figure out what tickets work for which mode of transit.
    </p>

    <p>Though there are plenty of governmental challenges out there that have to be overcame, through-ticketing can find itself working during the World Cup. People would love to see something like a though-ticketing solution for America's NEC (Northeast Corridor). The only reason the NEC was chosen was because that's the only profitable portion that Amtrak owns and 3 of the World Cup cities will be played along the NEC (Boston, Philly, and NYC). 
    </p>

    <p>Through-ticketing would not erase the current ticketing structures in place; therefore, it would be used as a secondary option to the existing platforms. People who choose the through-ticketing option could see benefits and cost saving opportunities. Each option could be successful during the World Cup, and beneficial to the customers so that convenience and ease of mobility occurs. 
    </p>

    <p>With the right approach, a through-ticketing pilot program could serve the NEC customers with ease and convenience during the World Cup.   
    </p>

</div>

<div id="footer">
    <p>CRP5850|Mapping and Countermapping Taught by Wenfei Xu.</p> 
</div>

<script src="./config.js"></script>
<script src="./js/drive.js"></script>
<script>

var layerTypes = {
    'fill': ['fill-opacity'],
    'line': ['line-opacity'],
    'circle': ['circle-opacity', 'circle-stroke-opacity'],
    'symbol': ['icon-opacity', 'text-opacity'],
    'raster': ['raster-opacity'],
    'fill-extrusion': ['fill-extrusion-opacity']
}

var alignments = {
    'left': 'lefty',
    'center': 'centered',
    'right': 'righty'
}

function getLayerPaintType(layer) {
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
}

function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        map.setPaintProperty(layer.layer, prop, layer.opacity);
    });
}

var story = document.getElementById('story');
var features = document.createElement('div');
features.classList.add(alignments[config.alignment]);
features.setAttribute('id', 'features');

var header = document.createElement('div');

if (config.title) {
    var titleText = document.createElement('h1');
    titleText.innerText = config.title;
    header.appendChild(titleText);
}

if (config.subtitle) {
    var subtitleText = document.createElement('h2');
    subtitleText.innerText = config.subtitle;
    header.appendChild(subtitleText);
}

if (config.byline) {
    var bylineText = document.createElement('p');
    bylineText.innerText = config.byline;
    header.appendChild(bylineText);
}

if (config.description) {
  var descriptionText = document.createElement("div");
  descriptionText.innerHTML = config.description;
  header.appendChild(descriptionText);
}

if (header.innerText.length > 0) {
    header.classList.add(config.theme);
    header.setAttribute('id', 'header');
    story.appendChild(header);
}

config.chapters.forEach((record, idx) => {
    var container = document.createElement('div');
    var chapter = document.createElement('div');
    
    if (record.title) {
        var title = document.createElement('h3');
        title.innerText = record.title;
        chapter.appendChild(title);
    }
    
    if (record.image) {
        var image = new Image();  
        image.src = record.image;  
        chapter.appendChild(image);
    }
    
    if (record.description) {
        var story = document.createElement('p');
        story.innerHTML = record.description;
        chapter.appendChild(story);
    }

    container.setAttribute('id', record.id);
    container.classList.add('step');
    if (idx === 0) {
        container.classList.add('active');
    }

    chapter.classList.add(config.theme);
    container.appendChild(chapter);
    features.appendChild(container);
});

story.appendChild(features);

// commented this out and added in footer in just HTML because otherwise the second text-container appears below the footer
// var footer = document.createElement('div');

// if (config.footer) {
//     var footerText = document.createElement('p');
//     footerText.innerHTML = config.footer;
//     footer.appendChild(footerText);
// }

// if (footer.innerText.length > 0) {
//     footer.classList.add(config.theme);
//     footer.setAttribute('id', 'footer');
//     story.appendChild(footer);
// }

mapboxgl.accessToken = config.accessToken;

const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;
    const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";

    return {
      url: url + suffix
    }
}

var map = new mapboxgl.Map({
    container: 'map',
    style: config.style,
    zoom: 6.5,
    maxZoom: 12,
    minZoom: 6.5,
    center: [-73.949, 40.752],
    // center: config.chapters[0].location.center,
    // zoom: config.chapters[0].location.zoom,
    // bearing: config.chapters[0].location.bearing,
    // pitch: config.chapters[0].location.pitch,
    scrollZoom: false,
    transformRequest: transformRequest
});

var marker = new mapboxgl.Marker();
if (config.showMarkers) {
    marker.setLngLat(config.chapters[0].location.center).addTo(map);
}

// instantiate the scrollama
var scroller = scrollama();

function handleStepProgress(response) {
    let stepProgress;

    if (response.element.id.slice(0,5) === 'drive') {
        let driveSlideNum = parseInt(response.element.id.slice(-2));
        if (driveSlideNum === 0) {
            map.setLayoutProperty('animatedLine', 'visibility', 'visible');
            stepProgress = Math.round(response.progress*driveSmoothness);
        } else {
            stepProgress = Math.round(response.progress*driveSmoothness+driveSmoothness*driveSlideNum);
        }
        changeCenter(stepProgress);
    }
}

map.on("load", function() {

    let w = window.innerWidth;
    let initBounds = routeData.features[0].geometry.coordinates;

    if (followPoint === false) {
        var bounds = initBounds.reduce(function(bounds, coord) {
            return bounds.extend(coord);
        }, new mapboxgl.LngLatBounds(initBounds[0], initBounds[0]));
         
        if (w >= 500) {
            map.fitBounds(bounds, {
                padding: {top: 150, bottom: 150, right: -100, left: 200},
                duration: 0
            });
        } else {
            map.fitBounds(bounds, {
                padding: 20,
                duration: 0
            });
        }
    } else {
        map.setZoom(followZoomLevel);
        map.setBearing(followBearing);
        map.setPitch(followPitch);
    }

    map.addSource('lineSource', {
        "type": "geojson",
        // turn off lineMetrics if not doing gradient colors
        lineMetrics: true,
        "data": geojsonPoint
    });

    map.addSource('pointSource', {
        "type": "geojson",
        "data": geojsonPoint
    });

    map.addLayer({
      "id": "animatedLine",
      "type": "line",
      "source": "lineSource",
      'paint': {
        // for static color
            // 'line-color': 'red',
            'line-opacity': 1,
            'line-width': 3.5,
            'line-gradient': [
            'interpolate',
            ['linear'],
            ['line-progress'],
            0,
            // '#A9E856',
            '#D37D1B',
            // 0.5,
            // '#58A4B0',
            1,
            // '#373F51'
            '#152B5F',
            // '#205962'
            ]

       },
       'layout': {
        //    'visibility': 'none'
       }
    });

    map.addLayer({
      "id": "animatedPoint",
      "type": "circle",
      "source": "pointSource",
      'paint': {
            'circle-radius': 5,
            'circle-opacity': 1,
            'circle-color': '#152B5F'
      },
      'layout': {
           // 'visibility': 'none'
       }
    });

    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.add('active');
        // map.flyTo(chapter.location);
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
    })
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
    })
    .onStepProgress(handleStepProgress);

    createLine();
});

// setup resize event
window.addEventListener('resize', scroller.resize);

$(document).ready(function (){
    $.ajax({
      // url:"./data/highwaydrive.geojson",
      url:"./data/test_2.geojson",
      dataType: "json",
      success: function (data) {
        console.log('data', data.features[0]);
        routeData = data;
      },
      error: function () {
        console.log('error loading data');
      }
    });
});

</script>

</body>
</html>
